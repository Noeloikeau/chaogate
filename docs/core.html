---

title: core


keywords: fastai
sidebar: home_sidebar

summary: "Primary functions for using `pyspice` to simulate the 3-MOSFET circuit known as a Chaogate."
description: "Primary functions for using `pyspice` to simulate the 3-MOSFET circuit known as a Chaogate."
nb_path: "00_core.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 00_core.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="imports">imports<a class="anchor-link" href="#imports"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span> <span class="c1">#ignore warnings</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
    
    <span class="kn">import</span> <span class="nn">copy</span>
    <span class="kn">import</span> <span class="nn">os</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">import</span> <span class="nn">gzip</span>
    <span class="kn">import</span> <span class="nn">numba</span>
    <span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">njit</span>
    <span class="kn">import</span> <span class="nn">sidis</span>
    <span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>

    <span class="kn">import</span> <span class="nn">PySpice.Logging.Logging</span> <span class="k">as</span> <span class="nn">Logging</span>
    <span class="kn">from</span> <span class="nn">PySpice.Doc.ExampleTools</span> <span class="kn">import</span> <span class="n">find_libraries</span>
    <span class="kn">from</span> <span class="nn">PySpice.Spice.Library</span> <span class="kn">import</span> <span class="n">SpiceLibrary</span>
    <span class="kn">from</span> <span class="nn">PySpice.Spice.Netlist</span> <span class="kn">import</span> <span class="n">Circuit</span>
    <span class="kn">from</span> <span class="nn">PySpice.Unit</span> <span class="kn">import</span> <span class="o">*</span>
    
    <span class="kn">import</span> <span class="nn">nptyping</span>
    <span class="kn">from</span> <span class="nn">nptyping</span> <span class="kn">import</span> <span class="n">NDArray</span> <span class="k">as</span> <span class="n">Array</span>
    <span class="kn">from</span> <span class="nn">nptyping</span> <span class="kn">import</span> <span class="n">get_type</span><span class="p">,</span><span class="n">Int</span><span class="p">,</span><span class="n">Float</span>
    <span class="kn">import</span> <span class="nn">typing</span>
    <span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="p">(</span><span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> 
                        <span class="n">Union</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">,</span> 
                        <span class="n">Hashable</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Any</span><span class="p">)</span>
    
    <span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>First, we must specify a global path to our <code>pyspice</code> library:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">global_path</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;C:\Anaconda3\Lib\site-packages\PySpice\Examples\libraries\chaogate&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We will use this to construct the <a href="/chaogate/core.html#chaogate"><code>chaogate</code></a>:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="netlist">netlist<a class="anchor-link" href="#netlist"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="chaogate" class="doc_header"><code>chaogate</code><a href="https://github.com/Noeloikeau/chaogate/tree/master/chaogate/core.py#L41" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>chaogate</code>(<strong><code>path</code></strong>:<code>str</code>=<em><code>'C:\\Anaconda3\\Lib\\site-packages\\PySpice\\Examples\\libraries\\chaogate'</code></em>, <strong><code>Vdd</code></strong>:<code>float</code>=<em><code>1.2</code></em>, <strong><code>Vin</code></strong>:<code>Optional</code>[<code>float</code>]=<em><code>0.45</code></em>, <strong><code>Vbias</code></strong>:<code>float</code>=<em><code>0.45</code></em>, <strong><code>w1</code></strong>=<em><code>1.2e-07</code></em>, <strong><code>w2</code></strong>=<em><code>1.2e-07</code></em>, <strong><code>w3</code></strong>=<em><code>2e-06</code></em>, <strong><code>l1</code></strong>=<em><code>6.5e-08</code></em>, <strong><code>l2</code></strong>=<em><code>6.5e-08</code></em>, <strong><code>l3</code></strong>=<em><code>6.5e-08</code></em>, <strong><code>capacitance</code></strong>:<code>int</code>=<em><code>1e-15</code></em>, <strong><code>noise</code></strong>:<code>Optional</code>[<code>float</code>]=<em><code>0</code></em>, <strong><code>noise_type</code></strong>:<code>str</code>=<em><code>'gaussian'</code></em>, <strong><code>noise_duration</code></strong>:<code>int</code>=<em><code>1e-09</code></em>, <strong><code>noise_delay</code></strong>:<code>int</code>=<em><code>0</code></em>, <strong><code>time_delay</code></strong>:<code>int</code>=<em><code>1e-09</code></em>, <strong><code>impedance</code></strong>:<code>int</code>=<em><code>50</code></em>, <strong><code>TEMP</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Constructs PySpice circuit object for a chaogate.</p>
<p>Parameters:</p>

<pre><code>`path` : location of folder containing following spice files
       '65nm_bulk.lib','bsim4.out','bsim4v5.out','nmos.mod','pmos.mod'

`vdd` : static positive terminal voltage in Volts.
    If `noise` is not 0 or None, a random source of `noise_type`
    fluctuating about `vdd` with amplitude `noise` is used to
    represent the supply voltage, with fluctuation lasting
    `noise_duration` ever `noise_delay` seconds.

`vin` : static input voltage in Volts.
    If vin=0 or None, it is replaced with a transmission line having
    the `time_delay` and `impedance` args that connects `vin` to `vout`.

`vbias` : bias voltage in Volts. This changes the MOSFET behavior.

`widths` : MOSFET widths of the three transistors in Meters

`lengths` : MOSFET lengths of the three transistors in Meters

`capacitance` : capacitor constant in Farads</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="tup2ar" class="doc_header"><code>tup2ar</code><a href="https://github.com/Noeloikeau/chaogate/tree/master/chaogate/core.py#L129" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>tup2ar</code>(<strong>*<code>t</code></strong>)</p>
</blockquote>
<p>Returns inclusive array 'x' of tuple 't' in (start,stop,step) format.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We set <code>Vin</code> default parameters as properties of the chaogate function, to preserve memory:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">chaogate</span><span class="o">.</span><span class="n">Vin_tup</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">chaogate</span><span class="o">.</span><span class="n">Vin_ar</span><span class="o">=</span><span class="n">tup2ar</span><span class="p">(</span><span class="o">*</span><span class="n">chaogate</span><span class="o">.</span><span class="n">Vin_tup</span><span class="p">)</span>
<span class="n">chaogate</span><span class="o">.</span><span class="n">Vin_slice</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">*</span><span class="n">chaogate</span><span class="o">.</span><span class="n">Vin_tup</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The subsequent dc transfer-function 'sweep' defaults to giving the Vin-Vout transfer curve over Vin=(0,1.2,0.01) by using <a href="/chaogate/core.html#tup2ar"><code>tup2ar</code></a> on these global parameters:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tup2ar</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span><span class="mf">0.01</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="transfer-function">transfer function<a class="anchor-link" href="#transfer-function"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="sweep" class="doc_header"><code>sweep</code><a href="https://github.com/Noeloikeau/chaogate/tree/master/chaogate/core.py#L147" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>sweep</code>(<strong>*<code>funcs</code></strong>, <strong>**<code>kwargs</code></strong>:<code>Optional</code>[<code>Dict</code>[<code>str</code>, <code>Union</code>[<code>float</code>, <code>tuple</code>]]])</p>
</blockquote>
<p>Performs a dc analysis sweep of the input voltage <code>Vin</code>,</p>
<p>and optionally over any tuples in <code>kwargs</code>. If any <code>kwargs</code></p>
<p>are not tuples, they are treated as circuit parameters for</p>
<p>instantiation. If any of the <code>kwargs</code> tuples are keyed by</p>
<p><code>Vbias</code>, <code>Vdd</code>, or <code>TEMP</code>, they are calculated in a single</p>
<p>sweep using the <code>simulator().dc</code> function call. Otherwise,</p>
<p>the chaogate netlist is repeatedly instantiated over the</p>
<p>changing parameters, and the simulator repeatedly called.</p>
<p>Returns a <code>DataArray</code> for each <code>kwargs</code> containing <code>vout</code></p>
<p>dc function call, and coordinates of the sweeped array(s).</p>
<p>If <code>funcs</code> is given, they are mapped over <code>vout</code> for each</p>
<p>sweep, and added as coordinates to the returned <code>DataArray</code>.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="/chaogate/core.html#sweep"><code>sweep</code></a> returns the Vin-Vout transfer curve as an <code>xarray.DataArray</code> object, which contains the useful property of referencing our <code>coordinates</code> as well as our <code>data</code> as attributes:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sweep</span><span class="p">()</span> <span class="c1">#equivalent to sweep(Vin=(0,1.2,0.01)); saves memory w/ global chaogate.Vin_ar</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">res</span><span class="o">=</span><span class="n">sweep</span><span class="p">(</span><span class="n">Vin</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span><span class="mf">0.1</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">Vin</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The traditional <code>numpy.ndarray</code> is stored in the <code>data</code> attribute:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Any tupled arg besides Vin results in a 2-D <a href="/chaogate/core.html#sweep"><code>sweep</code></a> of all Vin-Vout values over that arg.</p>
<p>Any non-tupled args are static netlist parameters for each of these transfer curves.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">v</span><span class="o">=</span><span class="n">sweep</span><span class="p">(</span><span class="n">Vin</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span><span class="mf">0.1</span><span class="p">),</span><span class="n">Vbias</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span><span class="mf">0.3</span><span class="p">),</span><span class="n">TEMP</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
<span class="k">for</span> <span class="n">vbias</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">Vbias</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">Vin</span><span class="p">,</span><span class="n">v</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">Vbias</span><span class="o">=</span><span class="n">vbias</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Vbias=</span><span class="si">{</span><span class="n">vbias</span><span class="o">.</span><span class="n">data</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Vin&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Vout&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Multiple tupled args gives a 2-D array for each tuple:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sweep</span><span class="p">(</span><span class="n">TEMP</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="n">w1</span><span class="o">=</span><span class="p">(</span><span class="mf">60e-9</span><span class="p">,</span><span class="mf">120e-9</span><span class="p">,</span><span class="mf">60e-9</span><span class="p">),</span><span class="n">Vin</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span><span class="mf">0.4</span><span class="p">),</span><span class="n">l2</span><span class="o">=</span><span class="mf">120e-9</span><span class="p">,</span><span class="n">Vbias</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="1-d-maps-and-chaos">1-d maps and chaos<a class="anchor-link" href="#1-d-maps-and-chaos"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="iterate_map" class="doc_header"><code>iterate_map</code><a href="https://github.com/Noeloikeau/chaogate/tree/master/chaogate/core.py#L255" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>iterate_map</code>()</p>
</blockquote>
<p>Iterates the map given by <code>vout</code> = f(<code>vin</code>), <code>N</code> times.
<code>vout</code> : [...,size(vin)] is an array of all the
chaogate output voltages over the <code>vin</code> inputs.
<code>v0</code> is the starting voltage. Returns an array
<code>X</code> : [vout.shape[:-1],N,2] containing the
map evaluations in the [...,0]th entry and the first
derivatives in the [...,1] entry for each curve of <code>vout</code>.
Note, if <code>vout.shape==vin.shape</code>, this will return an array
of shape [1,vin.size,2].</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="iterate" class="doc_header"><code>iterate</code><a href="https://github.com/Noeloikeau/chaogate/tree/master/chaogate/core.py#L285" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>iterate</code>(<strong><code>res</code></strong>, <strong><code>v0</code></strong>:<code>float</code>=<em><code>0</code></em>, <strong><code>N</code></strong>:<code>int</code>=<em><code>None</code></em>)</p>
</blockquote>
<p>Uses <a href="/chaogate/core.html#iterate_map"><code>iterate_map</code></a> with a default iteration number
corresponding to the length of the input array <code>vout</code>,
and reshapes according to this length. njit is unable
to do this, so we use two functions.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We iterate the chaogate 1-D map by passing in the transfer function, and then interpolating the equation</p>
<p>$V_{n+1} = f(V_{n})$</p>
<p>where $f$ is the interpolated <code>Vin-Vout</code> transfer curve obtained from <a href="/chaogate/core.html#sweep"><code>sweep</code></a>. Similarly, we calculate the derivative <code>f'</code> through interpolation in order to later calculate the Lyapunov exponent.</p>
<p>We define two functions, <a href="/chaogate/core.html#iterate_map"><code>iterate_map</code></a> and <a href="/chaogate/core.html#iterate"><code>iterate</code></a>, for operating on <code>numpy.ndarray</code> and <code>xarray.DataArray</code> objects respectively. They both do the same thing, but <a href="/chaogate/core.html#iterate_map"><code>iterate_map</code></a> is accelerated by <code>njit</code> and <a href="/chaogate/core.html#iterate"><code>iterate</code></a> uses <a href="/chaogate/core.html#iterate_map"><code>iterate_map</code></a> to operate directly off of the <a href="/chaogate/core.html#sweep"><code>sweep</code></a> result:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">res</span><span class="o">=</span><span class="n">sweep</span><span class="p">(</span><span class="n">Vin</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span><span class="mf">0.001</span><span class="p">),</span><span class="n">Vbias</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span><span class="mf">0.1</span><span class="p">))</span>
<span class="n">itr_xarray</span><span class="o">=</span><span class="n">iterate</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<span class="n">itr_numpy</span><span class="o">=</span><span class="n">iterate_map</span><span class="p">(</span><span class="n">vout</span><span class="o">=</span><span class="n">res</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">vin</span><span class="o">=</span><span class="n">res</span><span class="o">.</span><span class="n">Vin</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">N</span><span class="o">=</span><span class="n">res</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">v0</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">itr_numpy</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">itr_xarray</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">itr_numpy</span><span class="o">==</span><span class="n">itr_xarray</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$n$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$V_</span><span class="si">{n}</span><span class="s1">$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">itr_xarray</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">Vbias</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)[:</span><span class="mi">10</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>How do we know if the system is chaotic? We calculate the <a href="/chaogate/core.html#lyapunov"><code>lyapunov</code></a> exponent, which for a 1-D map is defined by</p>
<p>$\lambda(x) = \sum_{i=0}^{i=len(x)} |\log(f'(x_{i}))|$</p>
<p>If $\lambda&gt;0$, the system is chaotic. In our function definition we assume we have used the <a href="/chaogate/core.html#iterate"><code>iterate</code></a> function to obtain the derivative sequence as the <code>itr[...,1]</code> entry, and include some typecasting to parse <code>xarray.DataArray</code> objects vs. <code>numpy.ndarray</code>s.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lyapunov" class="doc_header"><code>lyapunov</code><a href="https://github.com/Noeloikeau/chaogate/tree/master/chaogate/core.py#L310" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lyapunov</code>(<strong><code>x</code></strong>:<code>NDArray</code>[<code>None</code>, <code>None</code>], <strong><code>replace_zeros_with</code></strong>:<code>Union</code>[<code>int</code>, <code>float</code>]=<em><code>0.01</code></em>)</p>
</blockquote>
<p>Returns average Lyapunov exponent of array 'x'.
Replaces zeros with <code>replace_zeros_with</code> to
calculate log correctly.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lyapunov</span><span class="p">(</span><span class="n">itr_numpy</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">lyapunov</span><span class="p">(</span><span class="n">itr_xarray</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now, it will be convenient to calculate a full sweep over a <a href="/chaogate/core.html#grid"><code>grid</code></a>, i.e, to include every combination of the <a href="/chaogate/core.html#sweep"><code>sweep</code></a> parameters:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="parameter-space-and-bifurcation">parameter space and bifurcation<a class="anchor-link" href="#parameter-space-and-bifurcation"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="grid" class="doc_header"><code>grid</code><a href="https://github.com/Noeloikeau/chaogate/tree/master/chaogate/core.py#L333" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>grid</code>(<strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Like 'sweep', but over all combinations of the <code>kwargs</code> tuples.
Returns a <code>kwargs</code>-dimensional hybercube ranging over all the
supplied tuples, in the form of an <code>xarray.DataArray</code> object.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="/chaogate/core.html#grid"><code>grid</code></a> sweeps over all combinations of the input parameters:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">g</span> <span class="o">=</span> <span class="n">grid</span><span class="p">(</span><span class="n">Vin</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span><span class="mf">0.01</span><span class="p">),</span><span class="n">Vbias</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span><span class="mf">0.01</span><span class="p">),</span><span class="n">Vdd</span><span class="o">=</span><span class="p">(</span><span class="mf">1.15</span><span class="p">,</span><span class="mf">1.25</span><span class="p">,</span><span class="mf">0.01</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Next, we will convert the grid to a <code>xarray.Dataset</code> object in order to add fields for the <a href="/chaogate/core.html#iterate"><code>iterate</code></a> and <a href="/chaogate/core.html#lyapunov"><code>lyapunov</code></a> data over the full parameter space. We do this through a simple conversion and dictionary update:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ds</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">to_dataset</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We must specify the dimensions over which the new data are to be added. We calculate the iteration with 2000 points, and discard the first 500 as a transient. Then, we parse the original dimensions to remove the last entry (<code>Vin</code>) as we don't use this in the calculation. We also add a new dimension for the iterations:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">itr</span><span class="o">=</span><span class="n">iterate</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="n">N</span><span class="o">=</span><span class="mi">2000</span><span class="p">)</span>
<span class="n">lya</span><span class="o">=</span><span class="n">lyapunov</span><span class="p">(</span><span class="n">itr</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">500</span><span class="p">:,:])</span>
<span class="n">ds</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">lyapunov</span><span class="o">=</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">dims</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">lya</span><span class="p">),</span>
              <span class="n">iterate</span><span class="o">=</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">dims</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="s1">&#39;Iterations&#39;</span><span class="p">],</span><span class="n">itr</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">500</span><span class="p">:,</span><span class="mi">0</span><span class="p">])</span>
              <span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now, we can easily extract the maximum lyapunov exponent in parameter space by using the <code>argmax</code> and <code>isel</code> methods.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lmax</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">lyapunov</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="o">...</span><span class="p">))</span> <span class="c1">#(...) means all dimensions; could do e.g [&#39;Vbias&#39;] for variation over Vdd</span>
<span class="nb">print</span><span class="p">(</span><span class="n">lmax</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We see the greatest lyapunov exponent is at <code>Vdd=1.16, Vbias=0.43</code>. Of course, we can extract the same information using the data itself and numpy, it's just more clunky and requires us to backtrack to find the coordinate indices...</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ds</span><span class="o">.</span><span class="n">lyapunov</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">lyapunov</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="n">ds</span><span class="o">.</span><span class="n">lyapunov</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now, we package this functionality (calculating <a href="/chaogate/core.html#iterate"><code>iterate</code></a> and <a href="/chaogate/core.html#lyapunov"><code>lyapunov</code></a>) into a pipeline <a href="/chaogate/core.html#bifurcate"><code>bifurcate</code></a>:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="bifurcate" class="doc_header"><code>bifurcate</code><a href="https://github.com/Noeloikeau/chaogate/tree/master/chaogate/core.py#L409" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>bifurcate</code>(<strong><code>res</code></strong>=<em><code>None</code></em>, <strong><code>v0</code></strong>=<em><code>0</code></em>, <strong><code>T</code></strong>=<em><code>500</code></em>, <strong><code>N</code></strong>=<em><code>1000</code></em>, <strong><code>as_grid</code></strong>=<em><code>False</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Creates a bifurcation of the system about the given parameters.</p>
<p>If <code>as_grid</code>, the result is assumed to be evaluated over a grid;</p>
<p>else, a <a href="/chaogate/core.html#sweep"><code>sweep</code></a> is assumed. If <code>res</code> is None, it is evaluated over</p>
<p><code>kwargs</code>. Iterates the resulting system <code>res</code> N times starting from</p>
<p><code>v0</code> using <a href="/chaogate/core.html#iterate"><code>iterate</code></a>, discarding the transient specified by the first</p>
<p><code>T</code> points. Calculates the <a href="/chaogate/core.html#lyapunov"><code>lyapunov</code></a> exponent over the iterated map,</p>
<p>and returns a <code>xarray.Dataset</code>. If not <code>as_grid</code>, the dataset has</p>
<p>a different variable for each of the specified <code>kwargs</code> sweeps; else,</p>
<p>there is a single variable for <code>vout</code>, <a href="/chaogate/core.html#lyapunov"><code>lyapunov</code></a>, and <a href="/chaogate/core.html#iterate"><code>iterate</code></a>.</p>
<p>Example use:</p>

<pre><code>bifurcate(
    Vbias = (0,1.2,0.01),
    Vdd = (1.1,1.3,0.1),
    TEMP = (20,30,5),
    as_grid = True
)</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">b</span><span class="o">=</span><span class="n">bifurcate</span><span class="p">(</span><span class="n">Vbias</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span><span class="mf">0.01</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can visualize bifurcation as the expansion or contraction of the system's state-space as a parameter is varied. We visualize this by plotting the set of iterations on the Y-axis, and the system parameter on the X-axis, with chaotic points in red</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">xaxis</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">Vbias</span><span class="o">.</span><span class="n">data</span>
<span class="n">yvalues</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">iterate_Vbias</span><span class="o">.</span><span class="n">data</span>
<span class="n">lyapunovs</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">lyapunov_Vbias</span><span class="o">.</span><span class="n">data</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">xaxis</span><span class="p">,</span> <span class="n">yvalues</span><span class="p">)):</span> <span class="c1"># (x,[set of y]) pairs</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:red&#39;</span> <span class="k">if</span> <span class="n">lyapunovs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;tab:blue&#39;</span> <span class="c1">#red if chaotic</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">x</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="o">=.</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$V_</span><span class="si">{bias}</span><span class="s1">$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$V_</span><span class="si">{n}</span><span class="s1">$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Next we will evaluate these properties over an entire grid and test the computational stability of the chaogate.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ds</span><span class="o">=</span><span class="n">bifurcate</span><span class="p">(</span><span class="n">Vbias</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span><span class="mf">0.01</span><span class="p">),</span><span class="n">Vdd</span><span class="o">=</span><span class="p">(</span><span class="mf">1.15</span><span class="p">,</span><span class="mf">1.25</span><span class="p">,</span><span class="mf">0.001</span><span class="p">),</span><span class="n">as_grid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now, let's examine the Hamming distances for the iterated maps. We will use this to gauge the stability of the system for computation; if one of the parameters varies, we don't want the bitstream to diverge, or it can't be used for stable logic</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="booleanization-and-computational-stability">booleanization and computational stability<a class="anchor-link" href="#booleanization-and-computational-stability"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="booleanize_ar" class="doc_header"><code>booleanize_ar</code><a href="https://github.com/Noeloikeau/chaogate/tree/master/chaogate/core.py#L475" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>booleanize_ar</code>(<strong><code>vn</code></strong>, <strong><code>threshold</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Convert the numpy array <code>vn</code> into a bitstream
according to <code>threshold</code>; values of <code>vn&gt;=threshold</code>
will be set to <code>1</code>, and values of <code>vn&lt;threshold</code>
will be set to <code>0</code>. If <code>threshold</code> is not supplied,
it defaults to halfway between the range of <code>vn</code>.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="booleanize" class="doc_header"><code>booleanize</code><a href="https://github.com/Noeloikeau/chaogate/tree/master/chaogate/core.py#L495" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>booleanize</code>(<strong><code>vn</code></strong>, <strong><code>threshold</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Like <a href="/chaogate/core.html#booleanize_ar"><code>booleanize_ar</code></a>, but with typecasting
for <code>xarray.DataArray</code> inputs.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The output of the analog system must be <a href="/chaogate/core.html#booleanize"><code>booleanize</code></a>d in order to produce a bitstream, or sequence of 0s and 1s. This is done by rounding about some threshold.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">booleanize</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.7</span><span class="p">,</span><span class="mf">0.2</span><span class="p">]),</span><span class="n">threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">booleanize</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.25</span><span class="p">]),</span><span class="n">threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="c1">#defaults to (max=0.5 - min=0)/2</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="boolean_gradient" class="doc_header"><code>boolean_gradient</code><a href="https://github.com/Noeloikeau/chaogate/tree/master/chaogate/core.py#L507" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>boolean_gradient</code>(<strong><code>vn</code></strong>, <strong><code>threshold</code></strong>=<em><code>None</code></em>, <strong><code>dimensions_up_to</code></strong>=<em><code>-1</code></em>)</p>
</blockquote>
<p>Compute the <a href="/chaogate/core.html#booleanize"><code>booleanize</code></a>d gradient of the
iterated map <code>vn</code>.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">grad</span> <span class="o">=</span> <span class="n">boolean_gradient</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">iterate</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">grad</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The first entry in grad is the matrix derivative along each direction; here, along Vdd and Vcc.
The rest mimics the shape of the original input.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="boolean_divergence" class="doc_header"><code>boolean_divergence</code><a href="https://github.com/Noeloikeau/chaogate/tree/master/chaogate/core.py#L521" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>boolean_divergence</code>(<strong><code>grad</code></strong>, <strong><code>N</code></strong>=<em><code>-1</code></em>, <strong><code>normalize</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>Compute the divergence of the absolute value of the
<a href="/chaogate/core.html#boolean_gradient"><code>boolean_gradient</code></a> <code>grad</code> after <code>N</code> iterations.
If <code>normalize</code>, divide the result by the max.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">div</span> <span class="o">=</span> <span class="n">boolean_divergence</span><span class="p">(</span><span class="n">grad</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">div</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The divergence has the shape of the parameter axes, as it averaged over the iterations.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">div</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The x-axis is Vcc, and the y-axis is Vdd.</p>
<p>Now let's compare the divergence to the chaotic regions, where the Lyapunov exponent &gt;0</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">matshow</span><span class="p">((</span><span class="n">ds</span><span class="o">.</span><span class="n">lyapunov</span><span class="o">.</span><span class="n">data</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">ds</span><span class="o">.</span><span class="n">lyapunov</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We see they have similar structure. For chaotic logic, we are interested in minimizing their overlap; we want the divergence to be minimal (small logic error), and the lyapunov exponent to be positive (chaos). To that end we can take a normalized linear combination, weighting the divergence by -1 and the lyapunov exponent by +1</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">normalized_lyapunov</span> <span class="o">=</span> <span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">lyapunov</span><span class="o">.</span><span class="n">data</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">ds</span><span class="o">.</span><span class="n">lyapunov</span><span class="o">.</span><span class="n">data</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">lyapunov</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="n">normalized_divergence</span> <span class="o">=</span> <span class="n">div</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">div</span><span class="p">)</span> 
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">normalized_lyapunov</span> <span class="o">-</span> <span class="n">normalized_divergence</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">optimizer</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can now use this as an optimization metric in our future efforts to create the "best" chaogate</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sidis</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

